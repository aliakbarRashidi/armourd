<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=640" />

    <link rel="stylesheet" href="stylesheets/core.css" media="screen"/>
    <link rel="stylesheet" href="stylesheets/mobile.css" media="handheld, only screen and (max-device-width:640px)"/>
    <link rel="stylesheet" href="stylesheets/pygment_trac.css"/>

    <script type="text/javascript" src="javascripts/modernizr.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script type="text/javascript" src="javascripts/headsmart.min.js"></script>
    <script type="text/javascript">
      $(document).ready(function () {
        $('#main_content').headsmart()
      })
    </script>
    <title>armourd by amorenoc</title>
  </head>

  <body>
    <a id="forkme_banner" href="https://github.com/amorenoc/armourd">View on GitHub</a>
    <div class="shell">

      <header>
        <span class="ribbon-outer">
          <span class="ribbon-inner">
            <h1>armourd</h1>
            <h2>a Linux daemon for process monitoring</h2>
          </span>
          <span class="left-tail"></span>
          <span class="right-tail"></span>
        </span>
      </header>

      <section id="downloads">
        <span class="inner">
          <a href="https://github.com/amorenoc/armourd/zipball/master" class="zip"><em>download</em> .ZIP</a><a href="https://github.com/amorenoc/armourd/tarball/master" class="tgz"><em>download</em> .TGZ</a>
        </span>
      </section>


      <span class="banner-fix"></span>


      <section id="main_content">
        <h1>
<a name="armourd" class="anchor" href="#armourd"><span class="octicon octicon-link"></span></a>armourd</h1>

<blockquote>
<p>A Linux daemon for process monitoring targeted at embedded systems running GNU/Linux.</p>
</blockquote>

<p>armourd restarts processes that stopped abnormally, by returning a nonzero exit
code. To watch an application armourd only needs the file path of the application
executable; no PID files, <em>no shell scripts</em>.</p>

<p>It works out of the box, as it takes roughly a couple of minutes to set it up.
Upon startup armourd interprets its configuration file,
which lists the pathnames of the services that need to be watched, e.g.:</p>

<div class="highlight highlight-sh"><pre><span class="nv">$ </span><span class="nb">echo</span> <span class="s1">'/opt/foo'</span> &gt; /etc/armourd.conf
<span class="nv">$ </span><span class="nb">echo</span> <span class="s1">'/opt/bar'</span> &gt;&gt; /etc/armourd.conf
</pre></div>

<p>You can also use file-name globs ('*' wildcard). For example, to watch all the
binaries under /usr/local/bin/:</p>

<div class="highlight highlight-sh"><pre><span class="nv">$ </span><span class="nb">echo</span> <span class="s1">'/usr/local/bin/*'</span> &gt; /etc/armourd.conf
</pre></div>

<p>See <a href="INSTALL">INSTALL</a> for details on how to build and run.</p>

<h2>
<a name="goals" class="anchor" href="#goals"><span class="octicon octicon-link"></span></a>Goals</h2>

<ul>
<li>simplest possible configuration</li>
<li>no library dependencies (other than the C library)</li>
<li>small memory footprint</li>
<li>fast recovery of processes</li>
</ul><h2>
<a name="caveats" class="anchor" href="#caveats"><span class="octicon octicon-link"></span></a>Caveats</h2>

<p>armourd is Linux-only by design, because it relies upon interfaces such as
<a href="http://man7.org/linux/man-pages/man7/epoll.7.html">epoll(7)</a> or <a href="http://man7.org/linux/man-pages/man7/netlink.7.html">netlink(7)</a> 
and <a href="http://man7.org/linux/man-pages/man5/proc.5.html">proc(5)</a> 
files that aren't available in other unices.
It is more suited to sysvinit-based systems; newer init systems, such as
<a href="http://upstart.ubuntu.com/">upstart</a> or <a href="http://www.freedesktop.org/wiki/Software/systemd/">systemd</a>, 
service recovery is readily available.</p>

<p>armourd does not start services, i.e. its not an init daemon; on the other hand, 
it runs independently of your init system, and thus is portable across Linux devices.</p>

<p>Forking servers will have their children terminate before restart. Although it is 
designed to recover system daemon programs, it can actually recover any application, 
with the limitation that currently only supports single-instance applications 
unless using the <a href="http://dbus.freedesktop.org/">D-Bus</a> interface (see below).</p>

<p><em>It does not recover applications hanging</em>. </p>

<h2>
<a name="dependencies" class="anchor" href="#dependencies"><span class="octicon octicon-link"></span></a>Dependencies</h2>

<p>The minimum required versions are:</p>

<ul>
<li>Linux kernel 2.6.27</li>
<li>GNU C Library (glibc) 2.8</li>
<li>GCC 4.1</li>
<li>Autoconf 2.50</li>
<li>D-Bus 1.6.x (not required)</li>
</ul><h2>
<a name="system-recovery" class="anchor" href="#system-recovery"><span class="octicon octicon-link"></span></a>System Recovery</h2>

<p>armourd can also be configured to talk to watchdog hardware.  In order to 
make your system fully reliable, you should have a process feeding a watchdog, 
although your mileage may vary.  Linux provides a very simple interface to watchdog timers
(<code>/dev/watchdog</code>) that armourd implements as a non-default feature, to
provide an all-round solution. To enable it:</p>

<pre><code>./configure --enable-watchdog
</code></pre>

<h2>
<a name="d-bus-interface" class="anchor" href="#d-bus-interface"><span class="octicon octicon-link"></span></a>D-Bus Interface</h2>

<p>Optionally, you can build the daemon with D-Bus support to commuincate with other 
applications. The D-Bus API exposes runtime information, and a method to watch 
running processes. The introspection XML data is:</p>

<div class="highlight highlight-xml"><pre><span class="nt">&lt;node&gt;</span>
  <span class="nt">&lt;interface</span> <span class="na">name=</span><span class="s">"org.freedesktop.DBus.Introspectable"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;method</span> <span class="na">name=</span><span class="s">"Introspect"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">"xml_data"</span> <span class="na">type=</span><span class="s">"s"</span> <span class="na">direction=</span><span class="s">"out"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/method&gt;</span>
  <span class="nt">&lt;/interface&gt;</span>
  <span class="nt">&lt;interface</span> <span class="na">name=</span><span class="s">"com.github.Armourd"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;method</span> <span class="na">name=</span><span class="s">"ListProcesses"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;arg</span> <span class="na">type=</span><span class="s">"a{sv}"</span> <span class="na">direction=</span><span class="s">"out"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/method&gt;</span>
    <span class="nt">&lt;method</span> <span class="na">name=</span><span class="s">"WatchProcess"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">"pid"</span> <span class="na">type=</span><span class="s">"i"</span> <span class="na">direction=</span><span class="s">"in"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;arg</span> <span class="na">name=</span><span class="s">"resultcode"</span> <span class="na">type=</span><span class="s">"u"</span> <span class="na">direction=</span><span class="s">"out"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/method&gt;</span>
  <span class="nt">&lt;/interface&gt;</span>
<span class="nt">&lt;/node&gt;</span>
</pre></div>

<h2>
<a name="examples" class="anchor" href="#examples"><span class="octicon octicon-link"></span></a>Examples</h2>

<p>Explicitly request to watch a running process, using
DBus, e.g. with <code>dbus-send</code> you would:</p>

<div class="highlight highlight-sh"><pre><span class="nv">$ </span>dbus-send --session --print-reply --type<span class="o">=</span>method_call <span class="se">\</span>
&gt; --dest<span class="o">=</span>com.github.Armourd /com/github/armourd <span class="se">\</span>
&gt; com.github.Armourd.WatchProcess int32:<span class="sb">`</span>pidof foo<span class="sb">`</span>
</pre></div>

<p>Or, using the <a href="src/dbus/client-example.py">example</a> Python script:</p>

<div class="highlight highlight-sh"><pre><span class="nv">$ </span>./client-example.py -w<span class="sb">`</span>pidof foo<span class="sb">`</span>
</pre></div>

<p>See <a href="http://www.linuxfromscratch.org/blfs/view/svn/general/dbus.html">http://www.linuxfromscratch.org/blfs/view/svn/general/dbus.html</a> for an example of how to build D-Bus</p>

<h2>
<a name="testsuite" class="anchor" href="#testsuite"><span class="octicon octicon-link"></span></a>Testsuite</h2>

<p>Current version is not production ready, as there aren't any tests.  Unit tests
to exercise the API's and integration tests to check the runtime behaviour are
a must.  This could be added as a configure option (e.g. --enable-tests) then
the user can run the make <em>check</em> target</p>

<h2>
<a name="todo" class="anchor" href="#todo"><span class="octicon octicon-link"></span></a>TODO</h2>

<ul>
<li>Testsuite</li>
<li>Logging</li>
<li>Configuration file parser needs to be rewritten (it is buggy)</li>
<li>Enable options in the configuration file and DBus interface to tailor
specific needs, e.g. return codes for success, recover script, etc.</li>
<li>Send a D-Bus signal when a watched application crashes/restarts</li>
</ul>
      </section>

      <footer>
        <span class="ribbon-outer">
          <span class="ribbon-inner">
            <p>this project by <a href="https://github.com/amorenoc">amorenoc</a> can be found on <a href="https://github.com/amorenoc/armourd">GitHub</a></p>
          </span>
          <span class="left-tail"></span>
          <span class="right-tail"></span>
        </span>
        <p>Generated with <a href="http://pages.github.com">GitHub Pages</a> using Merlot</p>
        <span class="octocat"></span>
      </footer>

    </div>

    
  </body>
</html>
